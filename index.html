<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSwan - Your Analysis Results</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [Keep all your existing CSS styles exactly the same] */
        html { height: 100%; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; margin: 0; padding: 20px; }
        body.modal-open { overflow: hidden; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background-color: #2F3746; color: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); text-align: left; overflow: hidden; position: relative; }
        .access-button { display: inline-flex; align-items: center; justify-content: center; padding: 14px 28px; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; border: none; text-decoration: none; font-size: 1.1rem; margin: 10px; min-width: 240px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .analysis-btn { background-color: #97d5e6; color: #0d3945; }
        .analysis-btn:hover { background-color: #79b9c9; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .brandhub-btn { background-color: #ffd166; color: #8a6d00; }
        .brandhub-btn:hover { background-color: #ffc145; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .demo-btn { background-color: #06d6a0; color: #004d36; }
        .demo-btn:hover { background-color: #05b386; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .button-container { display: flex; flex-wrap: wrap; justify-content: center; margin: 30px 0; }
        .document-preview { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); text-align: center; }
        .document-preview h3 { margin-top: 0; color: #2F3746; font-size: 1.5rem; }
        .document-preview p { color: #6B7280; margin-bottom: 20px; }
        .contact-info { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); text-align: center; }
        .contact-info a { color: #3B82F6; text-decoration: none; font-weight: bold; }
        .form-section { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .form-section h2 { margin-top: 0; color: #2F3746; font-size: 1.8rem; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #4B5563; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #82dfe0; border-radius: 8px; box-shadow: 0 4px 6px rgba(130, 223, 224, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; font-size: 1rem; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #5ac8ca; box-shadow: 0 6px 12px rgba(130, 223, 224, 0.4), inset 0 2px 4px rgba(0, 0, 0, 0.06); transform: translateY(-2px); }
        .submit-btn { background-color: #97d5e6; color: #0d3945; padding: 14px 28px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; border: none; width: 100%; font-size: 1.1rem; margin-top: 10px; }
        .submit-btn:hover { background-color: #79b9c9; }
        .privacy-notice { font-size: 0.85rem; color: #6B7280; margin-top: 15px; text-align: center; line-height: 1.4; }
        .privacy-notice a { color: #3B82F6; text-decoration: none; }
        @keyframes phone-ring { 0% { transform: rotate(0) scale(1); } 15% { transform: rotate(10deg) scale(1.1); } 30% { transform: rotate(-10deg) scale(1.1); } 45% { transform: rotate(5deg) scale(1.05); } 60% { transform: rotate(-5deg) scale(1.05); } 75% { transform: rotate(0) scale(1); } 100% { transform: rotate(0) scale(1); } }
        .animated-phone { display: inline-block; animation: phone-ring 2.5s ease-in-out infinite 1s; transform-origin: 50% 50%; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.7); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); width: 90%; max-width: 500px; position: relative; text-align: center; }
        .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .demo-prompt-modal .modal-content { max-width: 450px; }
        #backOffice { display: none; }
        .back-office-header { background-color: #2F3746; color: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; text-align: center; }
        .back-office-section { background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .project-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .project-item input, .project-item select { flex: 1; padding: 10px; border: 2px solid #82dfe0; border-radius: 8px; box-shadow: 0 4px 6px rgba(130, 223, 224, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; }
        .project-item input:focus, .project-item select:focus { outline: none; border-color: #5ac8ca; box-shadow: 0 6px 12px rgba(130, 223, 224, 0.4); transform: translateY(-2px); }
        .delete-btn { background: #EF4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .total-display { font-size: 1.5rem; font-weight: bold; color: #10B981; padding: 15px; background: #F3F4F6; border-radius: 8px; text-align: center; margin-top: 15px; }
        .monthly-payment-item { background: #F9FAFB; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #82dfe0; box-shadow: 0 4px 6px rgba(130, 223, 224, 0.15); }
        .monthly-payment-item input, .monthly-payment-item select { padding: 10px; border: 2px solid #82dfe0; border-radius: 8px; box-shadow: 0 4px 6px rgba(130, 223, 224, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; }
        .monthly-payment-item input:focus, .monthly-payment-item select:focus { outline: none; border-color: #5ac8ca; box-shadow: 0 6px 12px rgba(130, 223, 224, 0.4); transform: translateY(-2px); }
        .target-btn { position: fixed; bottom: 20px; right: 20px; z-index: 50; background: none; color: #FF6B6B; padding: 5px; border: none; font-size: 2.5rem; cursor: pointer; transition: transform 0.3s; }
        .target-btn:hover { transform: scale(1.2); }
        .status-message { padding: 10px; border-radius: 6px; margin: 10px 0; text-align: center; font-weight: bold; }
        .status-success { background-color: #D1FAE5; color: #065F46; border: 1px solid #A7F3D0; }
        .status-error { background-color: #FEE2E2; color: #991B1B; border: 1px solid #FECACA; }
        @media (max-width: 768px) { .button-container { flex-direction: column; align-items: center; } .access-button { width: 90%; margin: 10px 0; } .header { padding: 25px; } .project-item { flex-direction: column; } }
    </style>
</head>
<body>

<!-- FRONT OFFICE -->
<div id="frontOffice" class="container">
    <header class="header">
        <h1 class="text-3xl font-extrabold mb-4 text-white">Your Website Analysis Results</h1>
        <p class="text-lg mb-4 text-white">Thank you for your interest in WebSwan! I've completed your website analysis and prepared some valuable resources for you.</p>
        <p class="text-lg mb-4 text-white">Below you'll find direct access to your analysis results, my Interactive Brand Hub, and if you requested one, a free demo website.</p>
        <div class="mt-6 text-right">
            <p class="text-lg font-medium">Warm regards,<br><strong class="text-2xl font-extrabold text-white">The WebSwan</strong></p>
            <p class="text-sm italic opacity-70">Putting the pieces together for your long-term online success</p>
        </div>
    </header>

    <div class="button-container">
        <button id="analysisBtn" class="access-button analysis-btn">
            <i class="fas fa-chart-bar mr-2"></i> View Analysis Results
        </button>
        <a href="https://taniad2169.github.io/WebSwan-Brand-Hub/" class="access-button brandhub-btn" target="_blank">
            <i class="fas fa-cube mr-2"></i> Interactive Brand Hub
        </a>
        <button id="demoBtn" class="access-button demo-btn">
            <i class="fas fa-desktop mr-2"></i> Free Website Demo
        </button>
    </div>

    <div class="document-preview">
        <h3>Your Analysis Document</h3>
        <p>Click the button above to view your detailed website analysis</p>
    </div>

    <div class="form-section">
        <h2>Request a Free Website Demo</h2>
        <form id="demoRequestForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group"><label for="name">Full Name *</label><input type="text" id="name" name="name" placeholder="Your full name" required></div>
                <div class="form-group"><label for="email">Email Address *</label><input type="email" id="email" name="email" placeholder="Your email address" required></div>
                <div class="form-group"><label for="phone">Phone Number *</label><input type="tel" id="phone" name="phone" placeholder="Your phone number" required></div>
                <div class="form-group"><label for="businessName">Business Name *</label><input type="text" id="businessName" name="businessName" placeholder="Your business name" required></div>
                <div class="form-group md:col-span-2"><label for="websiteUrl">Website URL (if you have one)</label><input type="url" id="websiteUrl" name="websiteUrl" placeholder="https://www.yourwebsite.com"></div>
                <div class="form-group md:col-span-2"><label for="message">Additional Comments (Optional)</label><textarea id="message" name="message" rows="4" placeholder="Tell us about your business or any specific requirements..."></textarea></div>
            </div>
            <button type="submit" class="submit-btn">Request Free Demo</button>
            <div class="privacy-notice">We collect your information for the purpose of getting you a free web analysis and/or free website demo. We do not sell or share your information with third parties. <a href="https://www.thewebswan.com/privacy-policy" target="_blank">Click here to view our privacy policy</a>.</div>
        </form>
    </div>

    <div class="contact-info">
        <h3 class="text-xl font-bold mb-4">Questions? Let's Talk!</h3>
        <p class="mb-2">If you have any questions about your analysis or would like to discuss how we can improve your online presence, feel free to contact me directly:</p>
        <p class="text-lg font-bold"><i class="fas fa-phone-alt animated-phone"></i> <a href="tel:4158770687">(415) 877-0687</a></p>
    </div>
</div>

<!-- BACK OFFICE -->
<div id="backOffice" class="container">
    <div class="back-office-header">
        <h1 class="text-3xl font-bold">WebSwan Back Office</h1>
        <p class="mt-2">Document Management & Income Calculator</p>
        <button id="backToFrontBtn" class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg">‚Üê Back to Front</button>
    </div>

    <!-- CRM Search Section -->
    <div class="back-office-section">
        <h2 class="text-2xl font-bold mb-4">üîç Search Client Reports</h2>
        <div class="form-group">
            <label>Search by Phone Number or Email:</label>
            <div class="flex gap-2">
                <input type="text" id="crmSearchInput" placeholder="Enter phone number or email" class="flex-1">
                <button id="crmSearchBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md">Search</button>
            </div>
        </div>
        <div id="crmSearchResults" class="mt-4 hidden">
            <h3 class="text-lg font-bold mb-2">Search Results:</h3>
            <div id="crmResultsList" class="space-y-2"></div>
        </div>
        <div id="crmNoResults" class="mt-4 hidden">
            <p class="text-red-500 text-center">No client found with that phone number or email.</p>
        </div>
    </div>

    <!-- Document Management -->
    <div class="back-office-section">
        <h2 class="text-2xl font-bold mb-4">üìÑ Document Management</h2>
        <div class="form-group"><label>Current Client Email:</label><input type="text" id="docLeadIdentifier" placeholder="Enter Client Email" value=""></div>
        <div class="form-group"><label>Client Phone Number (for CRM):</label><input type="tel" id="docClientPhone" placeholder="Enter client phone number" value=""></div>
        <div class="form-group"><label>Upload Website Analysis Document (PDF):</label><input type="file" id="docFileUpload" accept=".pdf" class="border p-2 rounded-md"></div>
        <div class="form-group"><label>Free Demo URL:</label><input type="url" id="docDemoUrl" placeholder="https://demo-link.com" value=""></div>
        <div class="form-group"><label>Interactive Brand Hub URL:</label><input type="url" id="docBrandhubUrl" placeholder="https://brandhub-link.com" value="https://taniad2169.github.io/WebSwan-Brand-Hub/"></div>

        <button id="saveDocumentsBtn" class="submit-btn">Save Documents for This Client</button>
        <div id="docMessage" class="status-message hidden"></div>

        <!-- Client List -->
        <div class="mt-6">
            <h3 class="text-xl font-bold mb-3">Saved Clients</h3>
            <div class="bg-yellow-50 p-3 rounded-lg mb-3">
                <p class="text-sm text-yellow-800"><strong>üí° Button Guide:</strong><br>‚Ä¢ <strong>Load</strong> - Fill form with client's info<br>‚Ä¢ <strong>Copy Link</strong> - Copy client's report link & clear form<br>‚Ä¢ <strong>Delete</strong> - Remove client (for non-responsive leads)</p>
            </div>
            <div id="clientList" class="space-y-2"></div>
        </div>
    </div>

    <!-- Income Calculator -->
    <div class="back-office-section">
        <h2 class="text-2xl font-bold mb-4">üí∞ Project Income Calculator</h2>
        <div id="projectsList"></div>
        <button id="addProjectBtn" class="submit-btn mb-4">+ Add Project</button>
        <div class="total-display">Total Project Income: $<span id="projectTotal">0.00</span></div>
    </div>

    <!-- Monthly Payments Tracker -->
    <div class="back-office-section">
        <h2 class="text-2xl font-bold mb-4">üìÖ Monthly Payments Tracker</h2>
        <div id="monthlyPaymentsList"></div>
        <button id="addMonthlyPaymentBtn" class="submit-btn mb-4">+ Add Monthly Payment</button>
        <div class="total-display">Total Monthly Income: $<span id="monthlyTotal">0.00</span></div>
        <div class="total-display" style="background: #DBEAFE; color: #1E40AF;">GROSS INCOME (Projects + Monthly): $<span id="grossTotal">0.00</span></div>
    </div>
</div>

<!-- Target Button -->
<button id="targetBtn" class="target-btn">üéØ</button>

<!-- Login Modal -->
<div id="loginModal" class="modal"><div class="modal-content"><span class="close-btn" id="closeLoginModal">&times;</span><h2 class="text-2xl font-bold mb-4">Back Office Login</h2><input type="password" id="passwordInput" placeholder="Enter Password" class="w-full p-3 border rounded-md mb-4"><button id="loginBtn" class="submit-btn">Login</button><p id="loginError" class="text-red-500 text-center mt-3 hidden">Incorrect password</p></div></div>

<!-- Demo Prompt Modal -->
<div id="demoPromptModal" class="modal demo-prompt-modal"><div class="modal-content"><span class="close-btn" id="closeDemoPromptModal">&times;</span><div class="p-4"><i class="fas fa-desktop text-green-500 text-5xl mb-4"></i><h3 class="text-2xl font-bold mb-2">Request Your Free Demo</h3><p class="text-gray-700 mb-4">Fill out the form below to request your free website demo.</p><button class="submit-btn" id="goToFormBtn">Go to Form</button></div></div></div>

<!-- Success Modal -->
<div id="successModal" class="modal"><div class="modal-content"><span class="close-btn" id="closeSuccessModal">&times;</span><div id="successContent" class="p-4"><i class="fas fa-check-circle text-green-500 text-5xl mb-4"></i><h3 class="text-2xl font-bold mb-2">Request Submitted!</h3><p class="text-gray-700">Thank you for your interest in a free website demo. We'll be in touch shortly to discuss your project.</p><button class="submit-btn mt-4" id="modalOkBtn">OK</button></div></div></div>

<script>
    const ADMIN_PASSWORD = 'admin@777';
    const PROJECT_TYPES = ['Standard Web Design', 'Premium Web Design', 'Premium Plus Web Design', 'Custom Calendars', 'Forms', 'Ad Campaign Videos', 'Ad Campaign Script', 'Interactive Brand Hub'];
    const MONTHLY_SERVICES = ['Website Maintenance', 'Hosting', 'Security', 'Reputation Management', 'Calendar', 'Interactive Brand Hub', 'Form'];

    let projects = [];
    let monthlyPayments = [];
    let documentData = JSON.parse(localStorage.getItem('webswan_documents')) || {};

    // Project Calculator Functions
    function renderProjects() {
        const container = document.getElementById('projectsList');
        container.innerHTML = '';
        projects.forEach((project, index) => {
            const div = document.createElement('div');
            div.className = 'project-item';
            div.innerHTML = `<select onchange="updateProject(${index}, 'type', this.value)" class="p-2 border rounded-md">${PROJECT_TYPES.map(type => `<option value="${type}" ${project.type === type ? 'selected' : ''}>${type}</option>`).join('')}</select><input type="number" value="${project.price}" onchange="updateProject(${index}, 'price', this.value)" placeholder="Price" class="p-2 border rounded-md"><input type="text" value="${project.description}" onchange="updateProject(${index}, 'description', this.value)" placeholder="Description" class="p-2 border rounded-md"><button onclick="deleteProject(${index})" class="delete-btn">Delete</button>`;
            container.appendChild(div);
        });
        calculateTotals();
    }

    function addProject() { projects.push({ type: PROJECT_TYPES[0], price: 0, description: '' }); renderProjects(); saveToStorage(); }
    function updateProject(index, field, value) { projects[index][field] = field === 'price' ? parseFloat(value) || 0 : value; calculateTotals(); saveToStorage(); }
    function deleteProject(index) { projects.splice(index, 1); renderProjects(); saveToStorage(); }

    // Monthly Payments Functions
    function renderMonthlyPayments() {
        const container = document.getElementById('monthlyPaymentsList');
        container.innerHTML = '';
        monthlyPayments.forEach((payment, index) => {
            const div = document.createElement('div');
            div.className = 'monthly-payment-item';
            div.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-3 gap-3"><select onchange="updateMonthlyPayment(${index}, 'service', this.value)" class="p-2 border rounded-md">${MONTHLY_SERVICES.map(svc => `<option value="${svc}" ${payment.service === svc ? 'selected' : ''}>${svc}</option>`).join('')}</select><input type="number" value="${payment.amount}" onchange="updateMonthlyPayment(${index}, 'amount', this.value)" placeholder="Amount" class="p-2 border rounded-md"><input type="date" value="${payment.anniversary}" onchange="updateMonthlyPayment(${index}, 'anniversary', this.value)" class="p-2 border rounded-md"></div><button onclick="deleteMonthlyPayment(${index})" class="delete-btn mt-2">Delete</button>`;
            container.appendChild(div);
        });
        calculateTotals();
    }

    function addMonthlyPayment() { monthlyPayments.push({ service: MONTHLY_SERVICES[0], amount: 0, anniversary: '' }); renderMonthlyPayments(); saveToStorage(); }
    function updateMonthlyPayment(index, field, value) { monthlyPayments[index][field] = field === 'amount' ? parseFloat(value) || 0 : value; calculateTotals(); saveToStorage(); }
    function deleteMonthlyPayment(index) { monthlyPayments.splice(index, 1); renderMonthlyPayments(); saveToStorage(); }

    function calculateTotals() {
        const projectTotal = projects.reduce((sum, p) => sum + (parseFloat(p.price) || 0), 0);
        const monthlyTotal = monthlyPayments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
        const grossTotal = projectTotal + monthlyTotal;
        document.getElementById('projectTotal').textContent = projectTotal.toFixed(2);
        document.getElementById('monthlyTotal').textContent = monthlyTotal.toFixed(2);
        document.getElementById('grossTotal').textContent = grossTotal.toFixed(2);
    }

    function saveToStorage() {
        localStorage.setItem('webswan_projects', JSON.stringify(projects));
        localStorage.setItem('webswan_monthly', JSON.stringify(monthlyPayments));
        localStorage.setItem('webswan_documents', JSON.stringify(documentData));
    }

    function loadFromStorage() {
        const savedProjects = localStorage.getItem('webswan_projects');
        const savedMonthly = localStorage.getItem('webswan_monthly');
        const savedDocuments = localStorage.getItem('webswan_documents');
        if (savedProjects) projects = JSON.parse(savedProjects);
        if (savedMonthly) monthlyPayments = JSON.parse(savedMonthly);
        if (savedDocuments) documentData = JSON.parse(savedDocuments);
        renderProjects();
        renderMonthlyPayments();
        renderClientList();
        checkForClientDocument();
    }

    // CRM Search Functionality
    function searchClient() {
        const searchTerm = document.getElementById('crmSearchInput').value.trim().toLowerCase();
        if (!searchTerm) { alert('Please enter a phone number or email to search'); return; }
        const results = [];
        Object.keys(documentData).forEach(clientEmail => {
            const clientData = documentData[clientEmail];
            if (clientEmail.toLowerCase().includes(searchTerm)) results.push({ email: clientEmail, data: clientData });
            if (clientData.phone && clientData.phone.includes(searchTerm)) results.push({ email: clientEmail, data: clientData });
        });
        displaySearchResults(results);
    }

    function displaySearchResults(results) {
        const resultsContainer = document.getElementById('crmSearchResults');
        const noResultsContainer = document.getElementById('crmNoResults');
        const resultsList = document.getElementById('crmResultsList');
        resultsList.innerHTML = '';
        if (results.length === 0) { resultsContainer.classList.add('hidden'); noResultsContainer.classList.remove('hidden'); return; }
        noResultsContainer.classList.add('hidden'); resultsContainer.classList.remove('hidden');
        results.forEach(result => {
            const div = document.createElement('div');
            div.className = 'flex justify-between items-center p-3 bg-blue-50 rounded-lg';
            div.innerHTML = `<div><strong>${result.email}</strong><div class="text-sm text-gray-600">Phone: ${result.data.phone || 'Not provided'} | ${result.data.pdfData ? 'üìÑ Has Report' : 'No report'} | Saved: ${new Date(result.data.timestamp).toLocaleDateString()}</div></div><div><button onclick="loadClientFromSearch('${result.email}')" class="bg-green-500 text-white px-3 py-1 rounded mr-2">Load</button><button onclick="copyClientLink('${result.email}')" class="bg-purple-500 text-white px-3 py-1 rounded mr-2">Copy Link</button><button onclick="deleteClient('${result.email}')" class="bg-red-500 text-white px-3 py-1 rounded">Delete</button></div>`;
            resultsList.appendChild(div);
        });
    }

    function loadClientFromSearch(clientEmail) {
        loadClient(clientEmail);
        document.getElementById('docLeadIdentifier').scrollIntoView({ behavior: 'smooth' });
        document.getElementById('crmSearchResults').classList.add('hidden');
        document.getElementById('crmSearchInput').value = '';
    }

    // Document Management Functions - FIXED VERSION
    function saveDocuments() {
        const identifier = document.getElementById('docLeadIdentifier').value.trim();
        if (!identifier) { showMessage('Please enter a Client Email', 'error'); return; }

        const clientPhone = document.getElementById('docClientPhone').value.trim();
        const fileInput = document.getElementById('docFileUpload');
        const demoUrl = document.getElementById('docDemoUrl').value.trim();
        const brandhubUrl = document.getElementById('docBrandhubUrl').value.trim();

        // Store basic client info
        documentData[identifier] = {
            phone: clientPhone,
            demoUrl: demoUrl,
            brandhubUrl: "https://taniad2169.github.io/WebSwan-Brand-Hub/",
            timestamp: new Date().toISOString()
        };

        // Handle PDF file
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            if (file.type !== 'application/pdf') { showMessage('Please upload a PDF file only', 'error'); return; }
            if (file.size > 5 * 1024 * 1024) { showMessage('File too large. Please use a file smaller than 5MB.', 'error'); return; }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Store PDF data directly in the documentData
                documentData[identifier].pdfData = e.target.result;
                documentData[identifier].pdfFileName = file.name;
                
                saveToStorage();
                renderClientList();
                showMessage(`‚úÖ PDF saved successfully for ${identifier}! You can now copy the client link.`, 'success');
                clearForm();
            };
            reader.readAsDataURL(file);
        } else {
            saveToStorage();
            renderClientList();
            showMessage(`Client information saved for ${identifier} (no PDF uploaded)`, 'success');
            clearForm();
        }
    }

    function showMessage(message, type) {
        const messageDiv = document.getElementById('docMessage');
        messageDiv.textContent = message;
        messageDiv.className = 'status-message ' + (type === 'success' ? 'status-success' : 'status-error');
        messageDiv.classList.remove('hidden');
        if (type === 'success') setTimeout(() => messageDiv.classList.add('hidden'), 5000);
    }

    function clearForm() {
        document.getElementById('docLeadIdentifier').value = '';
        document.getElementById('docClientPhone').value = '';
        document.getElementById('docFileUpload').value = '';
        document.getElementById('docDemoUrl').value = '';
        document.getElementById('docBrandhubUrl').value = 'https://taniad2169.github.io/WebSwan-Brand-Hub/';
    }

    function renderClientList() {
        const container = document.getElementById('clientList');
        container.innerHTML = '';
        const clients = Object.keys(documentData);
        if (clients.length === 0) { container.innerHTML = '<p class="text-gray-500 text-center">No clients saved yet.</p>'; return; }
        clients.forEach(client => {
            const div = document.createElement('div');
            div.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
            div.innerHTML = `<div><strong>${client}</strong><div class="text-sm text-gray-600">${documentData[client].phone ? `üìû ${documentData[client].phone}` : 'No phone'} | ${documentData[client].pdfData ? 'üìÑ Has PDF Report' : 'No report'} | Saved: ${new Date(documentData[client].timestamp).toLocaleDateString()}</div></div><div class="flex gap-1"><button onclick="loadClient('${client}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">Load</button><button onclick="copyClientLink('${client}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm">Copy Link</button><button onclick="deleteClient('${client}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm">Delete</button></div>`;
            container.appendChild(div);
        });
    }

    function loadClient(clientEmail) {
        const clientData = documentData[clientEmail];
        if (!clientData) return;
        document.getElementById('docLeadIdentifier').value = clientEmail;
        document.getElementById('docClientPhone').value = clientData.phone || '';
        document.getElementById('docDemoUrl').value = clientData.demoUrl || '';
        document.getElementById('docBrandhubUrl').value = clientData.brandhubUrl || 'https://taniad2169.github.io/WebSwan-Brand-Hub/';
    }

    function copyClientLink(clientEmail) {
        const clientData = documentData[clientEmail];
        if (!clientData || !clientData.pdfData) {
            alert('This client has no PDF uploaded yet.');
            return;
        }

        // Create a special URL that contains the PDF data
        const currentUrl = window.location.href.split('?')[0];
        const pdfData = encodeURIComponent(clientData.pdfData);
        const clientUrl = `${currentUrl}?client=${encodeURIComponent(clientEmail)}&pdf=${pdfData}`;
        
        navigator.clipboard.writeText(clientUrl).then(() => {
            alert(`‚úÖ Client link copied to clipboard!\n\nWhen the client opens this link, their PDF will automatically open.\n\nForm has been cleared for next client.`);
            clearForm();
        }).catch(err => {
            alert('Failed to copy link. Please copy manually: ' + clientUrl);
        });
    }

    function deleteClient(clientEmail) {
        if (confirm(`Delete ${clientEmail}? This cannot be undone.`)) {
            delete documentData[clientEmail];
            saveToStorage();
            renderClientList();
            showMessage(`‚úÖ ${clientEmail} deleted.`, 'success');
            clearForm();
        }
    }

    function checkForClientDocument() {
        const urlParams = new URLSearchParams(window.location.search);
        const clientEmail = urlParams.get('client');
        const pdfData = urlParams.get('pdf');

        if (clientEmail && pdfData) {
            // We have a PDF in the URL - open it automatically
            const pdfDataUri = decodeURIComponent(pdfData);
            
            // Create and trigger PDF download
            const link = document.createElement('a');
            link.href = pdfDataUri;
            link.download = 'Website-Analysis-Report.pdf';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Also update the analysis button to show this PDF
            const analysisBtn = document.getElementById('analysisBtn');
            analysisBtn.onclick = function() {
                const link = document.createElement('a');
                link.href = pdfDataUri;
                link.download = 'Website-Analysis-Report.pdf';
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            analysisBtn.innerHTML = '<i class="fas fa-file-pdf mr-2"></i> View Your Analysis PDF';
        }
    }

    // Make functions global
    window.updateProject = updateProject;
    window.deleteProject = deleteProject;
    window.updateMonthlyPayment = updateMonthlyPayment;
    window.deleteMonthlyPayment = deleteMonthlyPayment;
    window.loadClient = loadClient;
    window.copyClientLink = copyClientLink;
    window.deleteClient = deleteClient;
    window.searchClient = searchClient;
    window.loadClientFromSearch = loadClientFromSearch;

    document.addEventListener('DOMContentLoaded', function() {
        loadFromStorage();
        
        // Event listeners
        document.getElementById('crmSearchBtn').addEventListener('click', searchClient);
        document.getElementById('crmSearchInput').addEventListener('keypress', function(e) { if (e.key === 'Enter') searchClient(); });
        document.getElementById('demoBtn').addEventListener('click', function() { document.getElementById('demoPromptModal').style.display = 'block'; document.body.classList.add('modal-open'); });
        document.getElementById('goToFormBtn').addEventListener('click', function() { document.getElementById('demoPromptModal').style.display = 'none'; document.body.classList.remove('modal-open'); document.getElementById('demoRequestForm').scrollIntoView({ behavior: 'smooth' }); });
        document.getElementById('demoRequestForm').addEventListener('submit', function(e) { e.preventDefault(); document.getElementById('successModal').style.display = 'block'; document.body.classList.add('modal-open'); this.reset(); });
        document.getElementById('targetBtn').addEventListener('click', function() { document.getElementById('loginModal').style.display = 'block'; document.body.classList.add('modal-open'); });
        document.getElementById('closeLoginModal').addEventListener('click', function() { document.getElementById('loginModal').style.display = 'none'; document.body.classList.remove('modal-open'); });
        document.getElementById('loginBtn').addEventListener('click', function() { const password = document.getElementById('passwordInput').value; if (password === ADMIN_PASSWORD) { document.getElementById('loginModal').style.display = 'none'; document.getElementById('frontOffice').style.display = 'none'; document.getElementById('backOffice').style.display = 'block'; document.body.classList.remove('modal-open'); document.getElementById('passwordInput').value = ''; document.getElementById('loginError').classList.add('hidden'); } else { document.getElementById('loginError').classList.remove('hidden'); } });
        document.getElementById('backToFrontBtn').addEventListener('click', function() { document.getElementById('backOffice').style.display = 'none'; document.getElementById('frontOffice').style.display = 'block'; });
        document.getElementById('saveDocumentsBtn').addEventListener('click', function(e) { e.preventDefault(); saveDocuments(); });
        document.getElementById('addProjectBtn').addEventListener('click', addProject);
        document.getElementById('addMonthlyPaymentBtn').addEventListener('click', addMonthlyPayment);
        document.getElementById('closeDemoPromptModal').addEventListener('click', function() { document.getElementById('demoPromptModal').style.display = 'none'; document.body.classList.remove('modal-open'); });
        document.getElementById('closeSuccessModal').addEventListener('click', function() { document.getElementById('successModal').style.display = 'none'; document.body.classList.remove('modal-open'); });
        document.getElementById('modalOkBtn').addEventListener('click', function() { document.getElementById('successModal').style.display = 'none'; document.body.classList.remove('modal-open'); });
        
        window.addEventListener('click', function(e) {
            if (e.target === document.getElementById('demoPromptModal')) { document.getElementById('demoPromptModal').style.display = 'none'; document.body.classList.remove('modal-open'); }
            if (e.target === document.getElementById('successModal')) { document.getElementById('successModal').style.display = 'none'; document.body.classList.remove('modal-open'); }
            if (e.target === document.getElementById('loginModal')) { document.getElementById('loginModal').style.display = 'none'; document.body.classList.remove('modal-open'); }
        });
    });
</script>
</body>
</html>
